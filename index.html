<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Portfolio</title>
    <!-- Ensure styles.css is correctly linked, use the correct path here -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>My Music Portfolio</h1>
        <div id="music-grid" class="grid"></div>
        <div class="add-track">
            <input type="text" id="track-title" placeholder="Track Title">
            <input type="text" id="track-url" placeholder="Track URL">
            <input type="file" id="track-file" accept="audio/*">
            <button onclick="addTrack()">Add Track</button>
        </div>
    </div>
    <audio id="audio-player" controls></audio>

    <!-- Firebase Initialization -->
    <script type="module">
        // Import Firebase modules for v9+
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAHo95URMAt-qUge5aMC0fFZDlGNYPocZw",
            authDomain: "music-b2e78.firebaseapp.com",
            databaseURL: "https://music-b2e78-default-rtdb.firebaseio.com",
            projectId: "music-b2e78",
            storageBucket: "music-b2e78.firebasestorage.app",
            messagingSenderId: "586258336427",
            appId: "1:586258336427:web:eff2544c9f73e163bcc5ee"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Array to store the tracks
        let tracks = [];

        // Check if tracks are saved in localStorage
        if (localStorage.getItem("tracks")) {
            tracks = JSON.parse(localStorage.getItem("tracks"));
            renderTracks();
        }

        // Function to render the tracks dynamically in the grid
        function renderTracks() {
            const musicGrid = document.getElementById("music-grid");
            musicGrid.innerHTML = "";  // Clear the grid before re-rendering
            tracks.forEach((track, index) => {
                const trackElement = document.createElement("div");
                trackElement.classList.add("track");

                // Create the track item with a play button and title
                const trackTitle = document.createElement("p");
                trackTitle.textContent = track.title;

                const playButton = document.createElement("button");
                playButton.textContent = "Play";
                playButton.onclick = () => playTrack(index);

                trackElement.appendChild(trackTitle);
                trackElement.appendChild(playButton);

                // If there is a track file (not a URL), display it
                if (track.file) {
                    const trackAudio = document.createElement("audio");
                    trackAudio.src = track.file;
                    trackAudio.controls = true;
                    trackElement.appendChild(trackAudio);
                } else {
                    const trackLink = document.createElement("a");
                    trackLink.href = track.url;
                    trackLink.target = "_blank";
                    trackLink.textContent = "Listen online";
                    trackElement.appendChild(trackLink);
                }

                musicGrid.appendChild(trackElement);
            });
        }

        // Function to add a track
        function addTrack() {
            const title = document.getElementById("track-title").value;
            const url = document.getElementById("track-url").value;
            const file = document.getElementById("track-file").files[0];

            if (title && (url || file)) {
                const newTrack = {
                    title: title,
                    url: url || null,
                    file: file ? URL.createObjectURL(file) : null
                };

                tracks.push(newTrack);
                localStorage.setItem("tracks", JSON.stringify(tracks));  // Save tracks to localStorage
                renderTracks();  // Re-render the tracks

                // Clear the input fields
                document.getElementById("track-title").value = "";
                document.getElementById("track-url").value = "";
                document.getElementById("track-file").value = "";
            }
        }

        // Function to play a track when clicked
        function playTrack(index) {
            const track = tracks[index];
            const audioPlayer = document.getElementById("audio-player");
            audioPlayer.src = track.file || track.url;
            audioPlayer.play();
        }
    </script>
</body>
</html>
